@page "/"

<PageTitle>Index</PageTitle>

<div class="landing-container">
	<div class="create-new-env-container">
		<button class="create-new-env" @onclick="OpenModal">
			Create a new environment
		</button>
	</div>
	<div class="recent-envs-container">
		<h2>Recent environments</h2>
		<div class="list-of-recent-envs">

		</div>
		<button class="see-all-envs">
			See all environments
		</button>
	</div>


	@if (isModalVisible)
	{
		<div class="modal-backdrop">
			<div class="modal">
				<div class="fileName">
					<h3>Create New Environment</h3>
					<label>File Name:</label>
					<input type="text" id="fileName" @bind="fileName">
				</div>
				<div class="languageName">
					<label>Programming Language:</label>
					<select id="selectedLanguage" @bind="selectedLanguage">
						@foreach (var language in languages)
						{
							<option value="@language.languageName">@language.languageName</option>
						}
					</select>
				</div>
				<div class="modal-buttons">
					<button @onclick="Cancel">Cancel</button>
					<button @onclick="CreateEnvironment">Create Environment</button>
				</div>
			</div>
		</div>
	}
</div>

@code {
	private bool isModalVisible = false;
	private string fileName = string.Empty;
	private string selectedLanguage = string.Empty;
	private List<(string languageName, string languageExtension)> languages = new List<(string, string)>
	{
		("C",".c"),
		("C++",".cpp"),
		("Java",".java") 
	};
	private string saveDirectory =  @"C:\Users\Oskaras\Documents\Kod\C#\VGTU C# ND 1\BlazorServerApp\BlazorServerApp\SavedEnvironments";

	private void OpenModal()
	{
		System.Console.WriteLine("OpenModal() was called");
		isModalVisible = true;
	}
	private void Cancel(){ // When cancelling the env creation dialogue this makes Modal dialog invisible 
		isModalVisible = false;
		// This clears the fileName and selectedLanguage, so it wouldn't save if they were to open the Modal again
		fileName = string.Empty;
		selectedLanguage = string.Empty;
	}
	private void CreateEnvironment()
	{
		if (!string.IsNullOrWhiteSpace(fileName) && !string.IsNullOrEmpty(selectedLanguage))
		{
			var selectedExtension = (languages.FirstOrDefault(lang => lang.languageName == selectedLanguage)).languageExtension;
			SaveFile(fileName, selectedExtension);
			// TODO: Need to implement routing to the created project environment
			// This closes the Modal dialogue and clears the variables out of stored data if a new modal was opened
			isModalVisible = false;
			fileName = string.Empty;
			selectedLanguage = string.Empty;
		}
		else // If the file name or the programming language is not entered properly, display an error message
		{

		}
	}
	private void SaveFile(string fileName, string fileExtension)
	{
		if (!Directory.Exists(saveDirectory))
		{
			Directory.CreateDirectory(saveDirectory);
		}
	
		string fullFileName = Path.Combine(saveDirectory, $"{fileName}{fileExtension}");
		try
		{
			// Save the content to the file
			File.WriteAllText(fullFileName, "");

			// Confirmation that the file has been saved (optional logging or UI feedback)
			Console.WriteLine($"File saved successfully at {fullFileName}");
		}
		catch (Exception ex)
		{
			// Handle any errors that occur during file creation
			Console.WriteLine($"Error saving file: {ex.Message}");
		}
	}
}